let e,t,r,o,n,l,s=Object.getPrototypeOf,i={isConnected:1},f={},a=s(i),c=s(s),u=(e,t,r,o)=>(e??(setTimeout(r,o),new Set)).add(t),h=(e,t,o)=>{let n=r;r=t;try{return e(o)}catch(e){return o}finally{r=n}},d=e=>e.filter(e=>e.t?.isConnected),y=e=>n=u(n,e,()=>{for(let e of n)e.o=d(e.o),e.l=d(e.l);n=l},1e3),b={get val(){return r?.i?.add(this),this.rawVal},get oldVal(){return r?.i?.add(this),this.u},set val(o){r?.h?.add(this),o!==this.rawVal&&(this.rawVal=o,this.o.length+this.l.length?(t?.add(this),e=u(e,this,j)):this.u=o)}},m=e=>({__proto__:b,rawVal:e,u:e,o:[],l:[]}),w=(e,t)=>{let r={i:new Set,h:new Set},n={f:e},l=o;o=[];let s=h(e,r,t);s=(s??document).nodeType?s:new Text(s);for(let e of r.i)r.h.has(e)||(y(e),e.o.push(n));for(let e of o)e.t=s;return o=l,n.t=s},p=(e,t=m(),r)=>{let n={i:new Set,h:new Set},l={f:e,s:t};l.t=r??o?.push(l)??i,t.val=h(e,n,t.rawVal);for(let e of n.i)n.h.has(e)||(y(e),e.l.push(l));return t},g=(e,...t)=>{for(let r of t.flat(1/0)){let t=s(r??0),o=t===b?w(()=>r.val):t===c?w(r):r;o!=l&&e.append(o)}return e},_=(e,t,...r)=>{let[o,...n]=s(r[0]??0)===a?r:[{},...r],i=e?document.createElementNS(e,t):document.createElement(t);for(let[e,r]of Object.entries(o)){let o=t=>t?Object.getOwnPropertyDescriptor(t,e)??o(s(t)):l,n=t+","+e,a=f[n]??=o(s(i))?.set??0,u=e.startsWith("on")?(t,r)=>{let o=e.slice(2);i.removeEventListener(o,r),i.addEventListener(o,t)}:a?a.bind(i):i.setAttribute.bind(i,e),h=s(r??0);e.startsWith("on")||h===c&&(r=p(r),h=b),h===b?w(()=>(u(r.val,r.u),i)):u(r)}return g(i,n)},O=e=>({get:(t,r)=>_.bind(l,e,r)}),S=(e,t)=>t?t!==e&&e.replaceWith(t):e.remove(),j=()=>{let r=0,o=[...e].filter(e=>e.rawVal!==e.u);do{t=new Set;for(let e of new Set(o.flatMap(e=>e.l=d(e.l))))p(e.f,e.s,e.t),e.t=l}while(++r<100&&(o=[...t]).length);let n=[...e].filter(e=>e.rawVal!==e.u);e=l;for(let e of new Set(n.flatMap(e=>e.o=d(e.o))))S(e.t,w(e.f,e.t)),e.t=l;for(let e of n)e.u=e.rawVal};const v={tags:new Proxy(e=>new Proxy(_,O(e)),O()),hydrate:(e,t)=>S(e,w(t,e)),add:g,state:m,derive:p};let x,A,P,{fromEntries:C,entries:E,keys:k,hasOwn:T,getPrototypeOf:D}=Object,{get:F,set:M,deleteProperty:N,ownKeys:V}=Reflect,{state:H,derive:K,add:L}=v,z=Symbol(),B=Symbol(),J=Symbol(),R=Symbol(),$=Symbol(),q=Symbol(),G=e=>e instanceof Object&&!(e instanceof Function)&&!e[q],I=e=>{if(e?.[B]){let t=H();return K(()=>{let r=e();G(t.rawVal)&&G(r)?re(t.rawVal,r):t.val=U(r)}),t}return H(U(e))},Q={get:(e,t,r)=>t===z?e:T(e,t)?Array.isArray(e)&&"length"===t?e.length:e[t].val:F(e,t,r),set:(e,t,r,o)=>T(e,t)?Array.isArray(e)&&"length"===t?(r!==e.length&&++e[R].val,e.length=r,1):(e[t].val=U(r),1):t in e?M(e,t,r,o):M(e,t,I(r))&&(++e[R].val,Y(e).forEach(Z.bind(A,o,t,e[t],P)),1),deleteProperty:(e,t)=>(N(e,t)&&ee(e,t),++e[R].val),ownKeys:e=>V(e)},U=e=>!G(e)||e[z]?e:new Proxy((e=>{let t=Array.isArray(e)?[]:{__proto__:D(e)};for(let[r,o]of E(e))t[r]=I(o);return t[J]=[],t[R]=H(1),t})(e),Q),W=D(H()),X=e=>e?.[z]?new Proxy((e=>new Proxy(e,{get:(e,t,r)=>D(e[t]??0)===W?{val:X(e[t].rawVal)}:F(e,t,r)}))(e[z]),Q):e,Y=e=>e[J]=e[J].filter(e=>e.m.isConnected),Z=(e,t,r,o,{m:n,f:l})=>{let s=Array.isArray(e),i=s?Number(t):t;L(n,()=>n[$][t]=l(r,()=>delete e[t],i)),s&&!o&&i!==e.length-1&&n.insertBefore(n.lastChild,n[$][k(e).find(e=>Number(e)>i)])},ee=(e,t)=>{for(let r of Y(e)){let e=r.m[$];e[t]?.remove(),delete e[t]}},te=(e,t)=>{for(let[r,o]of E(t)){let t=e[r];G(t)&&G(o)?te(t,o):e[r]=o}for(let r in e)T(t,r)||delete e[r];let r=k(t),o=Array.isArray(e);if(o||k(e).some((e,t)=>e!==r[t])){let n=e[z];if(o)e.length=t.length;else{++n[R].val;let e={...n};for(let e of r)delete n[e];for(let t of r)n[t]=e[t]}for(let{m:e}of Y(n)){let{firstChild:t,[$]:o}=e;for(let n of r)t===o[n]?t=t.nextSibling:e.insertBefore(o[n],t)}}return e},re=(e,t)=>{P=1;try{return te(e,t instanceof Function?Array.isArray(e)?t(e.filter(e=>1)):C(t(E(e))):t)}finally{P=A}},oe=e=>Array.isArray(e)?e.filter(e=>1).map(oe):G(e)?C(E(e).map(([e,t])=>[e,oe(t)])):e;const ne=v.state,le=Object.getPrototypeOf(ne()),se=e=>Object.getPrototypeOf(e)===le,ie={config:{shadow:{mode:"open"},callback:null},plugins:new Map,map:(e,...t)=>((e,t,r)=>{let o={m:e instanceof Function?e():e,f:r},n=t[z];o.m[$]={},n[J].push(o),(e=>{(x??(setTimeout(()=>(x.forEach(Y),x=A),1e3),x=new Set)).add(e)})(n);for(let[e,r]of E(n))Z(t,e,r,1,o);return o.m})(e instanceof HTMLElement?e:v.tags[e],...t),raw:e=>se(e)?X(e):(e=>(e[q]=1,e))(e),render:(e,t,r=!1)=>(r?v.hydrate:v.add)(e,t),serialize:oe,state:(e,t)=>{if(void 0!==t&&"boolean"!=typeof t)return re(t,e);if("function"==typeof e)return t?(e=>(e[B]=1,e))(e):v.derive(e);if("object"==typeof e){if(se(e))return(e=>e[z])(e[t||"val"]);if(!1!==t)return U(e)}return ne(e)},use:(e,t,r={})=>{if(ie[e])throw new Error(e);const o=new t({...r,app:ie.app}),n={},l=Object.getPrototypeOf(o);for(const e of Object.getOwnPropertyNames(l))"constructor"!==e&&"function"==typeof l[e]&&(n[e]=l[e].bind(o));return ie[e]=o,ie.plugins.set(e,{plugin:o,methods:n}),o}},fe=(e,t=String)=>{if(null==e)return e;if(t===Boolean)return"false"!==e;if(t===Object||t===Array)try{return JSON.parse(e)}catch{return t===Object?{}:[]}return t(e)},ae=(e,t,r={})=>{if(customElements.get(e))return;const{callback:o,metadata:n={},props:l={},shadow:s=ie.config.shadow}=r;customElements.define(e,class extends HTMLElement{constructor(){super(),Object.assign(this,n),this.props={},this.dismounts=[],this.root=s?this.attachShadow(s):this}static get observedAttributes(){return Object.keys(l)}attributeChangedCallback(e,t,r){this.props[e]&&(this.props[e].val=fe(r,l[e]))}connectedCallback(){const e={emit:(e,t,r=!1,o={})=>this.dispatchEvent(new CustomEvent(e,{...o,detail:t,bubbles:r})),mount:e=>this.dismounts.push(e?.()),props:(e,t)=>this.props[e]??=ne(this.hasAttribute(e)?fe(this.getAttribute(e),l[e]):t),$this:this,...ie};ie.plugins.forEach(({methods:t})=>{for(const r in t)e[r]=(...o)=>t[r](e,...o)}),ie.config.callback?.(e),o?.(e),ie.render(this.root,t(e))}disconnectedCallback(){this.dismounts.forEach(e=>e?.())}})},ce=e=>(e&&Object.assign(ie.config,e),ie.app=new Proxy(ae,{get:(e,t)=>ie[t]||v.tags[t],apply:(e,t,r)=>1===r.length?v.tags(r[0]):(e(...r),v.tags[r[0]])}),ie);export{ce as default};